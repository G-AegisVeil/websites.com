<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La B칰squeda del Prop칩sito</title>
    <style>
        /* ==================== AJUSTES ESPEC칈FICOS DE BLOGGER (FIX EXTREMO) ==================== */

        /* Oculta la barra de navegaci칩n superior (Navbar) */
        #navbar-iframe {
            display: none !important;
            height: 0 !important;
            visibility: hidden !important;
        }

        /* Oculta TODOS los elementos estructurales y widgets posibles */
        .header-outer, 
        .footer-outer, 
        .main-inner, 
        .sidebar-container, 
        .post-share-buttons,
        .widget-content, 
        .widget,
        .post-footer,
        .post-header,
        .blog-pager,
        .profile-link,
        .popup-box,
        .blogger-profile,
        .content-outer, 
        .column-left-outer, 
        .column-right-outer, 
        .main-inner .columns,
        .main-container,
        .tabs-outer, 
        .HTML, 
        .quickedit { 
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important; 
            max-height: 0 !important;
        }

        /* Fuerza el cuerpo y el contenedor a tomar el fondo oscuro A CUALQUIER COSTA */
        #outer-wrapper, 
        #content-wrapper, 
        body {
            background: #1a1a2e !important; 
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            box-sizing: border-box !important;
            overflow-x: hidden !important; 
            height: 100vh !important; 
            display: block !important; 
        }

        /* Asegura que el contenido de tu post (donde va tu c칩digo) sea visible */
        .post-body {
            display: block !important;
            padding: 0 !important;
            margin: 0 !important;
            width: 100% !important;
            min-height: 100vh !important; 
        }
        
        /* ==================== ESTILOS BASE Y CONTENEDOR ==================== */
        body {
            font-family: 'Georgia', serif;
            background-color: #1a1a2e; 
            color: #e4e4f0; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background-color 2s ease-in-out;
            box-sizing: border-box;
        }

        .container {
            /* PROPIEDADES CLAVE PARA LA POSICI칍N (Z-Index alto para prioridad) */
            position: relative; 
            z-index: 9999; 
            
            width: 100%;
            max-width: 800px;
            padding: 40px;
            background: rgba(40, 40, 60, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            text-align: center;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* ============== ESTILOS PARA LA IMAGEN ROM츼NTICA DE INICIO ============== */
        .initial-image-container {
            width: 100%;
            max-width: 400px; /* Tama침o m치ximo para la imagen */
            margin: 20px auto 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.4); /* Sombra dorada */
        }
        .initial-image-container img {
            width: 100%;
            height: auto;
            display: block;
        }
        /* ====================================================================== */

        /* ==================== GESTI칍N DE FASES ==================== */
        .phase {
            display: none; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-sizing: border-box;
            animation: fadeIn 1.5s ease-out;
            min-height: 450px; 
        }
        
        #initialScreen { display: flex; } 


        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #ffcc00;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            color: #c4c4d9;
            font-size: 1.5em;
            margin-top: 30px;
            margin-bottom: 25px; 
            text-align: center;
            width: 95%; 
            margin-left: auto;
            margin-right: auto;
        }

        .question-block {
            display: flex;
            flex-direction: column; 
            align-items: center; 
            width: 100%;
        }

        p {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Botones y Cuestionario */
        .btn {
            padding: 15px 35px;
            margin: 10px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-quiz {
            background-color: #3f3f5a;
            margin: 8px auto; 
            width: 90%;
            max-width: 450px; 
            color: #e4e4f0;
            display: block; 
            text-align: center; 
        }
        
        .btn-continue {
             background-color: #ffcc00; 
             color: #1a1a2e;
             margin-top: 20px;
        }
        
        #passCode {
            padding: 15px;
            margin: 20px auto;
            width: 80%;
            max-width: 350px;
            border-radius: 8px;
            border: 1px solid #ffcc00;
            background-color: #3f3f5a;
            color: #e4e4f0;
            font-size: 1.2em;
            text-align: center;
        }

        /* Estilo para las respuestas personalizadas */
        .custom-answer {
            width: 90%;
            max-width: 450px; 
            min-height: 50px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #5a5a7a;
            background-color: #3f3f5a;
            color: #e4e4f0;
            font-size: 0.9em;
            resize: vertical;
            margin-bottom: 20px;
            transition: opacity 0.5s ease;
        }
        
        /* FASE 5: Respuesta Abierta */
        #q5 textarea {
            width: 90%;
            max-width: 600px;
            min-height: 120px;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #5a5a7a;
            background-color: #3f3f5a;
            color: #e4e4f0;
            font-size: 1em;
            resize: vertical;
        }
        
        /* FASE 3: Propuesta */
        #phase3 { justify-content: space-between; }
        .proposal-content { width: 90%; margin: 20px auto; text-align: left; flex-grow: 1; }
        #proposalText { 
            font-size: 1.2em; 
            line-height: 1.8; 
            padding-left: 10px; 
            white-space: pre-wrap; 
            text-align: justify; 
            color: #e4e4f0; 
        }
        
        /* Estilos para el texto resaltado (Respuestas de ella) */
        .proposal-content .highlight {
             color: #00b894; 
             font-weight: bold;
        }

        .proposal-buttons-final { 
            margin-top: 40px; 
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .btn-formspree-send {
            background-color: #0087FF; /* Azul de Formspree */
            color: #fff;
            padding: 18px 40px;
            margin-top: 20px;
            text-transform: uppercase;
        }

        .ring-icon { font-size: 2em; color: #ffcc00; margin: 10px auto; display: block; width: fit-content;}

        /* Media Query para m칩vil */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 2em; }
            .proposal-content { width: 100%; text-align: center; }
            #proposalText { text-align: left; }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="initialScreen" class="phase">
            <h1>Mensaje Secreto Clasificado</h1>
            
            <div class="initial-image-container">
                <img id="romanticImage" src="https://i.pinimg.com/736x/ee/d3/74/eed374de6982b5bcbdccc05a7f4e66f1.jpg">
            </div>

            <p>He descubierto una coordenada importante para nuestro futuro, pero solo t칰 tienes la llave para abrirla.</p>
            <button class="btn btn-start pulsing" onclick="startDecodification()">
                Iniciar Desbloqueo (Presiona aqu칤)
            </button>
        </div>

        <div id="phase1" class="phase">
            <h1>Verificaci칩n de Acceso Personal</h1>
            <p>Para seguir, debes encontrar la clave que sella nuestro compromiso ante Dios.</p>
            
            <p id="bibleClue" style="font-size: 1.3em; color: #00b894; font-style: italic; margin: 30px 0;"></p>

            <input type="text" id="passCode" placeholder="Ingresa la Palabra Clave Aqu칤">
            <button class="btn btn-primary" onclick="checkCode()">Desbloquear Ruta</button>
            <p id="errorMsg" style="color: #ff6b6b; margin-top: 10px; display: none;">Palabra clave incorrecta. Vuelve a intentarlo.</p>
        </div>

        <div id="phase2" class="phase">
            <h1>Construyendo Nuestro Fundamento</h1>
            <p>춰Desbloqueaste las preguntas! Elige la respuesta que m치s se parezca a lo que deseas en el coraz칩n para revelar el mensaje final.</p>

            <form id="purposeQuiz">
                <div class="question-block" id="q1">
                    <h2>1. Para una relaci칩n exitosa, 쯖u치l de estos pilares de la fe es el m치s esencial en la otra persona?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="A" onclick="selectAnswer(this)">A) El Prop칩sito: Que ambos busquen ser luz, compartan el Evangelio y tengan un impacto fuerte en la vida de otros.</button>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="B" onclick="selectAnswer(this)">B) El Amor Incondicional: Que el amor sea la base, con mucha paciencia, gracia y perd칩n mutuo.</button>
                    <button type="button" class="btn btn-quiz" data-q="q1" data-a="C" onclick="selectAnswer(this)">C) La Uni칩n Espiritual: Que juntos adoren, oren y pongan a Dios como centro de todas las decisiones.</button>
                    <div class="quiz-feedback" style="display: none; color: #00b894; margin-top: 10px;">춰Esa base es s칩lida! Edificaremos sobre esa roca.</div>
                    
                    <p style="margin-top: 25px; font-size: 1em; color: #c4c4d9; border-top: 1px dashed #5a5a7a; padding-top: 15px;">
                        * Opcional: 쯈uieres agregar una respuesta propia?
                    </p>
                    <textarea class="custom-answer" id="customAnswerQ1" placeholder="Si tienes algo m치s espec칤fico en mente..."></textarea>

                    <button type="button" class="btn btn-continue" data-q="q1" onclick="continueQuiz(this)">
                        Continuar a la Pregunta 2
                    </button>
                </div>

                <div class="question-block" id="q2" style="display: none;">
                    <h2>2. 쯈u칠 caracter칤stica te gustar칤a que tuviera una relaci칩n para impulsarte a crecer?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="A" onclick="selectAnswer(this)">A) Un ambiente de refugio: Donde se respete el silencio, la reflexi칩n y el espacio para leer y crecer individualmente.</button>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="B" onclick="selectAnswer(this)">B) Un ambiente de reto: Donde haya metas claras y se sienta parte de un equipo que avanza y conquista sue침os.</button>
                    <button type="button" class="btn btn-quiz" data-q="q2" data-a="C" onclick="selectAnswer(this)">C) Un ambiente de aprendizaje: Donde ambos se reten a aprender, crear y enfrentar desaf칤os intelectuales o art칤sticos.</button>
                    <div class="quiz-feedback" style="display: none; color: #00b894; margin-top: 10px;">춰Esa es la energ칤a que te hace 칰nica!</div>
                    
                    <p style="margin-top: 25px; font-size: 1em; color: #c4c4d9; border-top: 1px dashed #5a5a7a; padding-top: 15px;">
                        * Opcional: 쯈uieres agregar una respuesta propia?
                    </p>
                    <textarea class="custom-answer" id="customAnswerQ2" placeholder="Si tienes algo m치s espec칤fico en mente..."></textarea>

                    <button type="button" class="btn btn-continue" data-q="q2" onclick="continueQuiz(this)">
                        Continuar a la Pregunta 3
                    </button>
                </div>

                <div class="question-block" id="q3" style="display: none;">
                    <h2>3. 쯈u칠 cualidad crees que debe tener la persona ideal para lograr una conexi칩n profunda?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="A" onclick="selectAnswer(this)">A) Intimidad de Coraz칩n: Que el cimiento sea la fe y el saber que ambos tienen el mismo horizonte eterno.</button>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="B" onclick="selectAnswer(this)">B) Total Aceptaci칩n: Que exista un refugio de seguridad total donde pueda ser vulnerable y libre de ser ella misma.</button>
                    <button type="button" class="btn btn-quiz" data-q="q3" data-a="C" onclick="selectAnswer(this)">C) Aventura Compartida: Que la relaci칩n sea un equipo din치mico que se rete a crecer y conquiste sue침os juntos.</button>
                    <div class="quiz-feedback" style="display: none; color: #00b894; margin-top: 10px;">춰Esa conexi칩n es el motor que quiero que nos impulse!</div>

                    <p style="margin-top: 25px; font-size: 1em; color: #c4c4d9; border-top: 1px dashed #5a5a7a; padding-top: 15px;">
                        * Opcional: 쯈uieres agregar una respuesta propia?
                    </p>
                    <textarea class="custom-answer" id="customAnswerQ3" placeholder="Si tienes algo m치s espec칤fico en mente..."></textarea>

                    <button type="button" class="btn btn-continue" data-q="q3" onclick="continueQuiz(this)">
                        Continuar a la Pregunta 4
                    </button>
                </div>
                
                <div class="question-block" id="q4" style="display: none;">
                    <h2>4. 쮺u치l de estas din치micas crees que es la m치s vital para garantizar el 칠xito en una relaci칩n?</h2>
                    <button type="button" class="btn btn-quiz" data-q="q4" data-a="A" onclick="selectAnswer(this)">A) Comunicaci칩n: Que cualquier problema o tema se hable de inmediato, con total respeto y honestidad.</button>
                    <button type="button" class="btn btn-quiz" data-q="q4" data-a="B" onclick="selectAnswer(this)">B) Tiempo Juntos: Que el tiempo de calidad intencional siempre sea una prioridad para fortalecer el v칤nculo.</button>
                    <button type="button" class="btn btn-quiz" data-q="q4" data-a="C" onclick="selectAnswer(this)">C) Logros Mutuos: Que se definan metas a corto plazo (estudio, trabajo, ministerio) para celebrar y avanzar en equipo.</button>
                    <div class="quiz-feedback" style="display: none; color: #00b894; margin-top: 10px;">춰Esa es la misi칩n que quiero compartir contigo!</div>

                    <p style="margin-top: 25px; font-size: 1em; color: #c4c4d9; border-top: 1px dashed #5a5a7a; padding-top: 15px;">
                        * Opcional: 쯈uieres agregar una respuesta propia?
                    </p>
                    <textarea class="custom-answer" id="customAnswerQ4" placeholder="Si tienes algo m치s espec칤fico en mente..."></textarea>

                    <button type="button" class="btn btn-continue" data-q="q4" onclick="continueQuiz(this)">
                        Continuar a la Pregunta 5 (Visi칩n)
                    </button>
                </div>

                <div class="question-block" id="q5" style="display: none;">
                    <h2>5. Mi visi칩n de futuro: Si pudieras describir en detalle la vida, los gustos y el ambiente donde te sientes completamente realizada, 쯤u칠 dir칤as? (S칠 lo m치s honesta posible)</h2>
                    <textarea id="openAnswer" placeholder="Ej: Anhelo un ambiente tranquilo con mucho arte y m칰sica, donde podamos tener largas conversaciones y tiempo para viajar a la naturaleza. Me siento realizada cuando..."></textarea>
                </div>


                <button type="button" class="btn btn-start" id="proposalBtn" style="display: none; margin-top: 40px;" onclick="submitFormAndPropose()">
                    춰Revelar la Coordenada Final!
                </button>
            </form>
        </div>

        <form id="phase3" class="phase" method="POST">
            <h1 style="color: #00b894;">La Declaraci칩n de Prop칩sito Eterno</h1>
            
            <div class="proposal-content">
                <div id="proposalText"></div>
                
                <div id="finalLinkContainer" style="display: none; margin-top: 30px; text-align: center;">
                    <p style="font-size: 1.2em; color: #ffcc00;">
                        춰칔ltimo paso! Env칤a las coordenadas para que las descifre.
                    </p>
                    <div id="hiddenFieldsContainer" style="display:none;"></div>
                </div>
            </div>
            
            <div id="proposalButtonsFinal" class="proposal-buttons-final" style="display: none;">
                 <button type="submit" class="btn btn-formspree-send">
                    <span style="font-size: 1.5em; vertical-align: middle;">游</span> Enviar Coordenadas al Servidor
                </button>
            </div>
        </form>
        
    </div>

    <script>
        // ====================================================================================
        // 丘멆잺 SECCI칍N DE PERSONALIZACI칍N OBLIGATORIA 丘멆잺
        // ====================================================================================
        const CUSTOM = {
            NAME: "Alicia", // 游뚿 REEMPLAZA ESTE NOMBRE POR EL DE ELLA 游뚿
            FORMSPREE_ID: "xanrkklv", // 游뚿 TU ID DE FORMSPREE 游뚿
            
            // 游뚿 ACERTIJO B칈BLICO (Tu elecci칩n: 1 Corintios 13:13) 游뚿
            BIBLE_QUIZ: {
                CLUE: "Busca la Palabra que encierra el vers칤culo de 1 Corintios 13:13, la que es mayor que la fe y la esperanza. Esa es la clave.", 
                ANSWER: "amor", // Respuesta en min칰sculas y sin tildes para verificaci칩n flexible.
            }
            // ====================================================================================
        };

        let quizAnswers = {};
        let quizCompleted = 0; 
        
        // Configurar el endpoint de Formspree
        document.getElementById('phase3').action = `https://formspree.io/f/${CUSTOM.FORMSPREE_ID}`;


        // Mensajes (Base de la Propuesta - Tono de compromiso)
        const PROPOSAL_BASE = `Mi apreciada ${CUSTOM.NAME},|L|Has completado este camino y cada respuesta ha revelado la profundidad de tu esp칤ritu. Estos son los cimientos que has elegido, y mi promesa al respecto:`;
        
        // DECLARACI칍N DE INTENCIONES (Lenguaje m치s natural)
        const PROPOSAL_FINAL = `|L||L|La claridad de tu fe, el deseo de tu coraz칩n y la audacia de tu visi칩n me llenan de una paz incre칤ble. Mi compromiso es ser el hombre que te apoye en cada sue침o, que luche por cada una de esas prioridades y que te ame con la Gracia incondicional de Dios.|L||L|Quiero que sepas que estoy comprometido a construir este futuro. **Hablemos pronto de estos cimientos, tengo mucho que decirte.**`;

        // M칩dulos de personalizaci칩n (Se usar치 la clase 'highlight' para el color verde)
        const PERSONALIZATION = {
            'q1': {
                'A': "El Prop칩sito es tu pilar; mi promesa es que ser칠 un compa침ero de vida que siempre te impulsar치 a ser luz y a servir a Dios.",
                'B': "El Amor Incondicional es tu pilar; mi promesa es que ser칠 ese espacio de gracia, perd칩n y aceptaci칩n que necesitas para ser libre.",
                'C': "La Uni칩n Espiritual es tu pilar; mi promesa es que construir칠 contigo ese altar de adoraci칩n en el que Dios siempre ser치 el centro.",
            },
            'q2': {
                'A': "Buscas un Refugio y respeto por el silencio; mi promesa es que ser칠 un guardi치n de ese espacio para que tu alma se renueve y florezca.",
                'B': "Buscas un Reto y un equipo; mi promesa es que ser칠 ese compa침ero de visi칩n que te impulse a conquistar cada meta divina.",
                'C': "Buscas Aprendizaje y creatividad; mi promesa es que ser칠 tu compa침ero de aventura intelectual y nunca dejaremos de avanzar y crecer juntos.",
            },
            'q3': { 
                'A': "Priorizas la Intimidad de Coraz칩n; mi promesa es que esa comuni칩n ser치 la roca inamovible para que nuestra estabilidad sea eterna.",
                'B': "Priorizas la Total Aceptaci칩n; mi promesa es ser el refugio m치s seguro donde te sientas libre de ser vulnerable y completamente t칰 misma.",
                'C': "Priorizas la Aventura Compartida; mi promesa es ser el mejor coequipero para que retemos al mundo y conquistemos cada sue침o a tu lado.",
            },
            'q4': { 
                'A': "Priorizas la Comunicaci칩n abierta; mi promesa es que construiremos un canal de respeto donde los conflictos se resuelvan siempre en amor y verdad.",
                'B': "Priorizas el Tiempo Juntos; mi promesa es que nuestro v칤nculo emocional siempre ser치 la prioridad que proteja el coraz칩n de nuestra relaci칩n.",
                'C': "Priorizas los Logros Mutuos; mi promesa es que definiremos juntos cada paso para que siempre celebremos y avancemos como un equipo invencible.",
            }
        };

        // ====================================================================================
        // L칍GICA PRINCIPAL Y DE FLUJO
        // ====================================================================================
        
        function nextPhase(phaseNumber) {
            document.querySelectorAll('.phase').forEach(p => p.style.display = 'none');
            
            const nextPhaseElement = document.getElementById(`phase${phaseNumber}`);
            if (nextPhaseElement) {
                nextPhaseElement.style.display = 'flex';
                if (phaseNumber === 3) {
                    typeProposalMessage();
                    // 游뚿 Nuevo: Insertar campos ocultos antes de la propuesta para el env칤o por Formspree
                    insertHiddenFormspreeFields(); 
                }
                
                window.scrollTo(0, 0); 
            }
        }
        
        window.startDecodification = () => {
            document.getElementById('initialScreen').style.display = 'none';
            document.getElementById('phase1').style.display = 'flex';
            document.body.style.backgroundColor = '#2e1a1a';
            // Mostrar el acertijo
            document.getElementById('bibleClue').textContent = CUSTOM.BIBLE_QUIZ.CLUE;
        }

        window.checkCode = () => {
            // Normaliza la respuesta
            const inputCode = document.getElementById('passCode').value
                               .trim()                         
                               .toLowerCase()                  
                               .normalize("NFD")               
                               .replace(/[\u0300-\u036f]/g, ""); 
            
            const requiredAnswer = CUSTOM.BIBLE_QUIZ.ANSWER
                                   .toLowerCase()
                                   .normalize("NFD")
                                   .replace(/[\u0300-\u036f]/g, "");
            
            const errorMsg = document.getElementById('errorMsg');
            
            if (inputCode === requiredAnswer) { 
                errorMsg.style.display = 'none';
                
                document.getElementById('phase1').innerHTML = `
                    <h1 style="color: #00b894;">춰LA PALABRA CLAVE ES CORRECTA!</h1>
                    <p style="font-size: 1.5em; animation: pulse 1s 3;">"Y ahora permanecen la fe, la esperanza y el **AMOR**. Pero el mayor de ellos es el **AMOR**." (1 Corintios 13:13)</p>`;
                
                document.body.style.backgroundColor = '#1a1a2e';
                
                // 丘멆잺 TIEMPO EXTENDIDO A 7 SEGUNDOS (7000ms)
                setTimeout(() => {
                    nextPhase(2); 
                }, 7000); 
                
            } else {
                errorMsg.style.display = 'block';
            }
        }

        // ====================================================================================
        // L칍GICA DEL CUESTIONARIO Y ENV칈O A FORMSPREE
        // ====================================================================================
        
        window.selectAnswer = (button) => {
            const qId = button.getAttribute('data-q');
            const fullAnswerText = button.textContent.trim().replace(/^.\) /, ''); // 游뚿 CORRECCI칍N: Almacena el texto completo sin la letra (A), (B), etc.
            const qBlock = document.getElementById(qId);
            const customInput = document.getElementById(`customAnswer${qId.toUpperCase()}`);

            // Estilos y guardado de respuestas
            qBlock.querySelectorAll('.btn-quiz').forEach(btn => {
                btn.style.backgroundColor = '#3f3f5a';
                btn.style.opacity = 1;
            });
            
            quizAnswers[qId] = fullAnswerText; // 游뚿 CORRECCI칍N: Almacena el texto.
            button.style.backgroundColor = '#00b894';

            if (customInput) {
                customInput.disabled = true;
                customInput.style.opacity = 0.5;
                customInput.value = ''; 
            }

            qBlock.querySelector('.quiz-feedback').style.display = 'block';
            qBlock.querySelector('.btn-continue').disabled = false;
        };
        
        window.continueQuiz = (button) => {
            const qId = button.getAttribute('data-q');
            const qBlock = document.getElementById(qId);
            const customInput = document.getElementById(`customAnswer${qId.toUpperCase()}`);
            let answered = false;
            
            if (customInput && customInput.value.trim() !== "") {
                 quizAnswers[qId] = customInput.value.trim();
                 answered = true;
            } else if (quizAnswers[qId]) {
                answered = true;
            }

            if (!answered) {
                alert("Por favor, selecciona una opci칩n o ingresa tu propia respuesta para continuar.");
                return;
            }
            
            qBlock.style.display = 'none'; 
            
            const nextQNum = parseInt(qId.slice(1)) + 1;
            const nextQId = `q${nextQNum}`;
            const nextQBlock = document.getElementById(nextQId);

            if (nextQBlock) {
                if (nextQId === 'q5') {
                     nextQBlock.style.display = 'flex';
                     document.getElementById('proposalBtn').style.display = 'block';
                } else {
                    nextQBlock.style.display = 'flex';
                }
            } 
            
            window.scrollTo(0, 0); 
        };


        window.submitFormAndPropose = () => {
             const openAnswerElement = document.getElementById('openAnswer');
             if (openAnswerElement.value.trim() === "") {
                 alert("Por favor, describe tu visi칩n de futuro en la pregunta 5 para continuar.");
                 return;
             }
             quizAnswers['q5'] = openAnswerElement.value.trim();

            nextPhase(3);
        };
        
        // ====================================================================================
        // INTEGRACI칍N FORMSPREE
        // ====================================================================================
        
        function insertHiddenFormspreeFields() {
            const container = document.getElementById('hiddenFieldsContainer');
            container.innerHTML = ''; 

            // 1. Campo de Asunto (Subject)
            let subjectInput = document.createElement('input');
            subjectInput.setAttribute('type', 'hidden');
            subjectInput.setAttribute('name', '_subject');
            subjectInput.setAttribute('value', `춰Coordenadas Finales de ${CUSTOM.NAME} recibidas!`);
            container.appendChild(subjectInput);

            // 2. Campo del Nombre de la Persona
            let nameInput = document.createElement('input');
            nameInput.setAttribute('type', 'hidden');
            nameInput.setAttribute('name', 'Nombre_de_la_Persona');
            nameInput.setAttribute('value', CUSTOM.NAME);
            container.appendChild(nameInput);
            
            // 3. Crear campos individuales para cada respuesta con el texto completo
            
            let introText = document.createElement('input');
            introText.setAttribute('type', 'hidden');
            introText.setAttribute('name', 'Mensaje_Inicial');
            introText.setAttribute('value', `El/Ella ha llegado al final de la b칰squeda y ha enviado sus coordenadas. A continuaci칩n, las respuestas completas:`);
            container.appendChild(introText);
            
            for (const qId in quizAnswers) {
                if (quizAnswers.hasOwnProperty(qId)) {
                    let field = document.createElement('input');
                    field.setAttribute('type', 'hidden');
                    
                    let fieldName = '';
                    switch(qId) {
                        case 'q1': fieldName = 'Q1_Pilar_de_Fe'; break;
                        case 'q2': fieldName = 'Q2_Ambiente_de_Crecimiento'; break;
                        case 'q3': fieldName = 'Q3_Cualidad_de_Conexi칩n'; break;
                        case 'q4': fieldName = 'Q4_Din치mica_Vital'; break;
                        case 'q5': fieldName = 'Q5_VISION_PERSONAL_CLAVE'; break;
                        default: fieldName = qId;
                    }
                    
                    field.setAttribute('name', fieldName);
                    // 游뚿 CORRECCI칍N: El valor ya contiene el texto completo o la respuesta abierta.
                    field.setAttribute('value', quizAnswers[qId]); 
                    container.appendChild(field);
                }
            }

            // 4. Se elimina el campo Enlace_Codificado_Completo para limpiar el correo.

            document.getElementById('finalLinkContainer').style.display = 'block';
        }

        // ====================================================================================
        // Funciones de decodificaci칩n y tipeo (SIN CAMBIOS)
        // ====================================================================================
        
        function getPersonalizedText(qId) {
            // Ya que quizAnswers ahora guarda el texto completo, debemos adaptarnos:
            const answer = quizAnswers[qId];
            
            // Si el valor guardado es una respuesta A/B/C, lo consideramos texto completo de la opci칩n.
            // Si es una respuesta custom, ya es texto.
            
            if (qId !== 'q5' && answer && answer.length > 1) { 
                // Si se seleccion칩 una de las opciones A, B, C (que ya guard칩 el texto completo)
                // Usamos el texto de la opci칩n para encontrar la promesa en PERSONALIZATION
                
                let optionLetter = '';
                // Buscamos cu치l opci칩n de PERSONALIZATION coincide con el texto guardado
                for (const letter in PERSONALIZATION[qId]) {
                     // Solo comparamos el inicio del texto para encontrar la letra.
                     if (PERSONALIZATION[qId][letter].startsWith(answer.substring(0, 10))) { 
                         optionLetter = letter;
                         break;
                     }
                }
                
                // Si encontramos la letra, devolvemos la promesa. Si no, asumimos que fue una respuesta custom
                if (optionLetter) {
                    return PERSONALIZATION[qId][optionLetter];
                }
            }

            if (qId !== 'q5') {
                 // Si es una respuesta custom o la l칩gica de arriba fall칩.
                return `Tu propia respuesta fue:\u2581L"${answer}"`;
            }
            // q5 se maneja en typeProposalMessage directamente.
            return ""; 
        }
        
        window.typeProposalMessage = () => {
            const textElement = document.getElementById('proposalText');
            let charIndex = 0;
            
            let message = PROPOSAL_BASE 
                .replace(/\|L\|/g, '\u2581L') 
                .replace(/\|P\|/g, '\u2581P')
                .replace(/\|H\|/g, '\u2581H');

            message += '\u2581L' + '||' + getPersonalizedText('q1') + '||' + '\u2581L'; 
            message += '\u2581L' + '||' + getPersonalizedText('q2') + '||' + '\u2581L';
            message += '\u2581L' + '||' + getPersonalizedText('q3') + '||' + '\u2581L';
            message += '\u2581L' + '||' + getPersonalizedText('q4') + '||';
            
            if (quizAnswers['q5']) {
                message += `\u2581L\u2581LPero lo m치s importante es tu visi칩n de futuro.\u2581LMi compromiso es ser el hombre que te ayude a construir este ambiente que describes:\u2581L\u2581H"**${quizAnswers['q5']}**"\u2581L\u2581P`;
            } else {
                message += '\u2581L\u2581P';
            }
            
            message += PROPOSAL_FINAL
                 .replace(/\|L\|/g, '\u2581L') 
                 .replace(/\|P\|/g, '\u2581P')
                 .replace(/\|H\|/g, '\u2581H'); 

            const typingSpeed = 30; 
            const pauseTime = 1500; 

            textElement.innerHTML = '';

            function type() {
                if (charIndex >= message.length) {
                    document.getElementById('proposalButtonsFinal').style.display = 'flex';
                    return;
                }

                if (message.charAt(charIndex) === '\u2581') {
                    const nextChar = message.charAt(charIndex + 1);
                    charIndex += 2; 

                    if (nextChar === 'P') { setTimeout(type, pauseTime); return; }
                    if (nextChar === 'H') { 
                        textElement.innerHTML += '<div class="ring-icon pulsing">游눐</div>';
                        setTimeout(type, 10);
                        return;
                    } 
                    if (nextChar === 'L') { 
                        textElement.innerHTML += '<br>';
                        setTimeout(type, 10);
                        return;
                    }
                }

                if (message.substring(charIndex, charIndex + 2) === '**') {
                    const nextStarIndex = message.indexOf('**', charIndex + 2);
                    if (nextStarIndex !== -1) {
                        const boldText = message.substring(charIndex + 2, nextStarIndex);
                        const span = document.createElement('span');
                        span.innerHTML = `<strong>${boldText}</strong>`;
                        span.classList.add('highlight'); 
                        textElement.appendChild(span);
                        charIndex = nextStarIndex + 2;
                        setTimeout(type, typingSpeed * boldText.length / 4); 
                        return;
                    }
                }
                
                if (message.substring(charIndex, charIndex + 2) === '||') {
                    const nextDoublePipeIndex = message.indexOf('||', charIndex + 2);
                    if (nextDoublePipeIndex !== -1) {
                        const answerText = message.substring(charIndex + 2, nextDoublePipeIndex);
                        const span = document.createElement('span');
                        span.textContent = answerText;
                        span.classList.add('highlight'); 
                        textElement.appendChild(span);
                        charIndex = nextDoublePipeIndex + 2;
                        setTimeout(type, typingSpeed * answerText.length / 4); 
                        return;
                    }
                }
                
                const char = message.charAt(charIndex);
                const span = document.createElement('span');
                span.textContent = char;
                textElement.appendChild(span);
                
                charIndex++;
                setTimeout(type, typingSpeed);
            }
            type();
        };

        function generateFinalLink() {
            // Se mantiene por si se quiere el enlace codificado, pero no se enviar치.
            const jsonAnswers = JSON.stringify(quizAnswers);
            const encoded = btoa(jsonAnswers);
            return `RespuestasCodificadas=${encoded}`; 
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            // Asegura que la pantalla de inicio sea la primera en cargarse
            document.getElementById('initialScreen').style.display = 'flex';
        });

    </script>
</body>
</html>
